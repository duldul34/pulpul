<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
  layout:decorate="~{layout/default_layout}">

  <th:block layout:fragment="css">
    <link th:href="@{/css/fragments/header.css}" rel="stylesheet" />
	  <link th:href="@{/css/fragments/footer.css}" rel="stylesheet" />
  	<link rel="stylesheet" th:href="@{/css/lookup/goodsDetail.css}" >
  	<link rel="stylesheet" th:href="@{/css/swiper-bundle.min.css}" >
  </th:block>
  
  <th:block layout:fragment="script">
  	<script th:src="@{/js/swiper-bundle.min.js}" defer></script>
  	<script th:src="@{/js/lookup/goodsDetail.js}" defer></script>
  	<script src="https://kit.fontawesome.com/6478f529f2.js"
    crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  </th:block>

	<div layout:fragment="content">
		<script th:inline="javascript">
  		console.log('데이터 확인');
  		var goods = [[${goods}]];
  		console.log(goods);
  		var reviewList = [[${reviewList}]];
  		console.log(reviewList);
  		var orderId = [[${orderId}]];
  		console.log(orderId);
  	</script>
		<div id="pageWrap">
      <div id="infoCover">
		    <div class="swiper-container mySwiper">
		      <div class="swiper-wrapper">
		        <div class="swiper-slide" th:each="img : ${goods.item.imageUrlList}">
		          <img th:src="${img}" />
		        </div>
		      </div>
		      <div class="swiper-button-next"></div>
		      <div class="swiper-button-prev"></div>
		      <div class="swiper-pagination"></div>
		    </div>

        <div id="info">
          <div id="tagWrap">
            <div th:each="tag : ${#strings.arraySplit(goods.tags, ',')}" th:text="|#${tag}|" class="tag"></div>
          </div>

          <div id="itemName" th:text="${goods.item.name}"></div>

          <div id="itemInfo" th:text="${goods.item.description}"></div>

          <div id="priceWrap">
            <div id="priceTit">판매 가격</div>
            <div id="price" th:text="|${#numbers.formatInteger(goods.price, 0, 'COMMA')}원|"></div>
          </div>

          <div id="itemNumWrap">
            <div id="itemNumTit">수량</div>
            <input type="number" min="1" placeholder="0" id="itemNumInput" name="quantity" th:onclick="totalPrice()"/>
          </div>

          <div id="itemSizeWrap">
            <div id="itemSizeTit">식물 크기</div>
            <div id="itemSize" th:text="|${goods.size} (가로, 세로)|"></div>
          </div>

          <hr class="hr-dotted" />

          <div id="totalPriceWrap">
            <div id="totalPriceTit">총 결제금액</div>

            <div id="calWrap">
              <div id="itemPriceWrap">
                <div id="itemPrice" th:text="|${#numbers.formatInteger(goods.price, 0, 'COMMA')}원|"></div>
                <div id="itemPriceTit">(판매가격)</div>
              </div>

              <div id="mul">X</div>

              <div id="itemQuantityWrap">
                <div id="itemQuantity"></div>
                <div id="itemQuantityTit">(수량)</div>
              </div>

              <img src="/images/add.svg" />

              <div id="shippingWrap">
                <div id="shipping" th:text="|${#numbers.formatInteger(goods.shippingFee, 0, 'COMMA')}원|"></div>
                <div id="shippingTit">(배송비)</div>
              </div>
            </div>

            <div id="totalPrice">원</div>
          </div>

          <div id="btnWrap">
            <button id="cartBtn" th:onclick="moveToCart([[${goods.item.id}]])">장바구니</button>
            <button id="cancelBtn" onclick="location.href='/lookup/goodsList'">취소</button>
          </div>

          <a href="/lookup/market/goodsList" id="marketLink">
            <img src="/images/smallShopIcon.svg" />
            <span th:text="|${goods.item.market.name} 마켓으로 이동하기|"></span>
          </a>
        </div>
      </div>

      <div id="reviewHeader">
        <div id="reviewTit">상품 리뷰</div>
        <div id="ratingTotalWrap">
          <img src="/images/star.svg" />
          <div id="ratingTotal"></div>
        </div>
      </div>

      <div id="reviewBox" th:each="review : ${reviewList}">
        <div id="reviewContent">
          <div id="reviewWrap">
            <img src="/images/reviewer.svg" />

            <div id="reviewerBox">
              <div id="ratingWrap">
                <img src="/images/star.svg" />
                <div id="rating" th:text="${review.rating}"></div>
              </div>

              <div id="reviewerWrap">
                <div id="reviewer" th:text="${review.order.buyer.id}"></div>
                <div id="reviewDate" th:text="${review.writeDate}"></div>
              </div>
            </div>
          </div>
        </div>

        <div id="review"></div>

        <hr class="hr-dotted" />
      </div>
      <form action="/review">
      <div id="reviewBox" th:if="${not #strings.isEmpty(orderId)}">
        <div id="reviewContent">
          <div id="reviewWrap">
            <img src="/images/reviewer.svg" />

            <div id="reviewerBox" class="reviewer-box">
              <div id="ratingWrap">
                <div class="review-rating">
		            <img src="/images/star.svg" />
			         <select name='rating'>
					  <option value='5.0' selected>5.0</option>
					  <option value='4.0'>4.0</option>
					  <option value='3.0'>3.0</option>
					  <option value='2.0'>2.0</option>
					  <option value='1.0'>1.0</option>
					</select>
		        </div>
              </div>
            </div>
          </div>
          <textarea id="writeReview" maxlength="200" placeholder="리뷰를 작성해주세요. (최소 20자, 최대 200자입니다.)"></textarea>
          <div id="imgBox">
              <div class="imgTit">상품 사진</div>
	          <input class="upload" type="file" id="fileWrap" accept=".jpg" multiple="multiple" name="file" style="display:none;">
		       <div class="upload-img-icon-box"><i class="fas fa-camera fa-2x"></i></div>
		       <div class="upload-img"></div>
          </div>
         </div>
        <div id="reviewBtnWrap">
           <button type="submit" id="writeReviewBtn" th:onclick="uploadReview([[${orderId}]],[[${goods.item.id}]])">리뷰 작성</button>
        </div>
        </div>
        </form>
    </div>
	</div>
</html>